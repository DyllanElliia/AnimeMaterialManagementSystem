<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>image_change</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <style type="text/css">
        .bottom-item {
            left: 0;
            position: fixed;
            bottom: 0;
            /* top 0 就是顶部 */
            width: 100%;
            z-index: 100;
            background: #343537;
            display: flex;
            justify-content: center;
            color: #ffff;
        }
        
        .range_group .range_single {
            height: 60px;
            width: 400px;
            margin: 0 auto;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/camanjs/4.1.1/caman.full.min.js"></script>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js">
    </script>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <!-- 导航栏 -->

        <a class="navbar-brand" href="#">
             动漫素材采集系统

         </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
             <span class="navbar-toggler-icon"></span>
         </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item ">
                    <a class="nav-link" href="/index?USER={{USER_NAME}}">
                         首页
                         <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/index/search?USER={{USER_NAME}}">
                         爬虫搜索
                     </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link " >
                         在线处理
                     </a>

                </li>
                <li class="nav-item">
                    <a class="nav-link " href="/index/dowload?USER={{USER_NAME}}" tabindex="-1" aria-disabled="false">

                         素材管理</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link justify-content-center" href="#" tabindex="-1" aria-disabled="false">
                         可爱的{{USER_NAME}}酱 欢迎使用本系统！
                     </a>
            </ul>

            <form class="form-inline my-2 my-lg-0">

                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">搜索</button>
            </form>
        </div>
    </nav>

    </br>
    <div style="text-align:center;">
        <i>欢迎使用基于CamanJS的在线图像处理系统</i>
        </br>
        tips：现在只做了下载功能 上传本地图片以及保存到云端正在开发...
    </div>
    </br>
    </br>

    <div class="container">
        <div class="row">
            <div class="col">
                <!-- 中部画布 -->
                <canvas id="J_Canvas0" style="border:10px solid #000000;border-style: double"> </canvas>

            </div>




            <div class="col">
                <!-- 中部画布调节 -->
                </br>

                <div class="range_group">
                    <div class="range_single">
                        <span class="label label-primary">
                             亮度
                         </span>
                        <input id="txt_brightness" type="text" style="width: 30px;height: 20px;" value=0 />

                        <input type="range" id="range_brightness" class="custom-range" style="width: 160px;" value="0" min="-100" max="100" step="1" onchange="changeV()">

                        <svg id="reset_brightness" width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-arrow-repeat" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="CURSOR: pointer">
                             <path fill-rule="evenodd"
                                 d="M2.854 7.146a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L2.5 8.207l1.646 1.647a.5.5 0 0 0 .708-.708l-2-2zm13-1a.5.5 0 0 0-.708 0L13.5 7.793l-1.646-1.647a.5.5 0 0 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0 0-.708z" />
                             <path fill-rule="evenodd"
                                 d="M8 3a4.995 4.995 0 0 0-4.192 2.273.5.5 0 0 1-.837-.546A6 6 0 0 1 14 8a.5.5 0 0 1-1.001 0 5 5 0 0 0-5-5zM2.5 7.5A.5.5 0 0 1 3 8a5 5 0 0 0 9.192 2.727.5.5 0 1 1 .837.546A6 6 0 0 1 2 8a.5.5 0 0 1 .501-.5z" />
                         </svg>

                    </div>

                    <div class="range_single">
                        <label for="vibrance" class="label label-primary">
                             饱和
                         </label>
                        <input id="txt_vibrance" type="text" style="width: 30px;height: 20px;" value=0 />
                        <input type="range" id="range_vibrance" class="custom-range" style="width: 160px;" value="0" min="-100" max="100" step="1" onchange="changeV()">
                        <svg id="reset_vibrance" width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-arrow-repeat" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="CURSOR: pointer">
                             <path fill-rule="evenodd"
                                 d="M2.854 7.146a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L2.5 8.207l1.646 1.647a.5.5 0 0 0 .708-.708l-2-2zm13-1a.5.5 0 0 0-.708 0L13.5 7.793l-1.646-1.647a.5.5 0 0 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0 0-.708z" />
                             <path fill-rule="evenodd"
                                 d="M8 3a4.995 4.995 0 0 0-4.192 2.273.5.5 0 0 1-.837-.546A6 6 0 0 1 14 8a.5.5 0 0 1-1.001 0 5 5 0 0 0-5-5zM2.5 7.5A.5.5 0 0 1 3 8a5 5 0 0 0 9.192 2.727.5.5 0 1 1 .837.546A6 6 0 0 1 2 8a.5.5 0 0 1 .501-.5z" />
                         </svg>
                    </div>

                    <div class="range_single">
                        <label for="contrast" class="label label-primary">对比 </label>
                        <input id="txt_contrast" type="text" style="width: 30px;height: 20px;" value=0 />
                        <input type="range" id="range_contrast" class="custom-range" style="width: 160px;" value="0" min="-50" max="50" step="1" onchange="changeV()">
                        <svg id="reset_contrast" width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-arrow-repeat" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="CURSOR: pointer">
                             <path fill-rule="evenodd"
                                 d="M2.854 7.146a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L2.5 8.207l1.646 1.647a.5.5 0 0 0 .708-.708l-2-2zm13-1a.5.5 0 0 0-.708 0L13.5 7.793l-1.646-1.647a.5.5 0 0 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0 0-.708z" />
                             <path fill-rule="evenodd"
                                 d="M8 3a4.995 4.995 0 0 0-4.192 2.273.5.5 0 0 1-.837-.546A6 6 0 0 1 14 8a.5.5 0 0 1-1.001 0 5 5 0 0 0-5-5zM2.5 7.5A.5.5 0 0 1 3 8a5 5 0 0 0 9.192 2.727.5.5 0 1 1 .837.546A6 6 0 0 1 2 8a.5.5 0 0 1 .501-.5z" />
                         </svg>
                    </div>

                    <div class="range_single">
                        <label for="hue" class="label label-primary">色调 </label>
                        <input id="txt_hue" type="text" style="width: 30px;height: 20px;" value=0 />
                        <input type="range" id="range_hue" class="custom-range" style="width: 160px;" value="0" min="0" max="100" step="1" onchange="changeV()">
                        <svg id="reset_hue" width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-arrow-repeat" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="CURSOR: pointer">
                             <path fill-rule="evenodd"
                                 d="M2.854 7.146a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L2.5 8.207l1.646 1.647a.5.5 0 0 0 .708-.708l-2-2zm13-1a.5.5 0 0 0-.708 0L13.5 7.793l-1.646-1.647a.5.5 0 0 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0 0-.708z" />
                             <path fill-rule="evenodd"
                                 d="M8 3a4.995 4.995 0 0 0-4.192 2.273.5.5 0 0 1-.837-.546A6 6 0 0 1 14 8a.5.5 0 0 1-1.001 0 5 5 0 0 0-5-5zM2.5 7.5A.5.5 0 0 1 3 8a5 5 0 0 0 9.192 2.727.5.5 0 1 1 .837.546A6 6 0 0 1 2 8a.5.5 0 0 1 .501-.5z" />
                         </svg>
                    </div>



                </div>
            </div>
        </div>


        <br />

        <div class="row">
            <div class="col-1"> <button type="button" class="btn btn-outline-primary">滤镜</button>
            </div>
            <div class="col-6">
                <!-- 滤镜调节 -->


                <div class="btn-group" role="group" aria-label="Basic example">


                    <button id="sinCity" type="button" class="btn btn-secondary">漫画风</button>
                    <button id="Nostalgia" type="button" class="btn btn-secondary">怀旧</button>
                    <button id="HazyDays" type="button" class="btn btn-secondary">朦胧</button>
                    <button id="HerMajesty" type="button" class="btn btn-secondary">庄严</button>
                    <button id="Love" type="button" class="btn btn-secondary">青春</button>

                </div>

            </div>

            <div class="col-1"></div>
            <div class="col-1">


                <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-upload" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                     <path fill-rule="evenodd"
                         d="M.5 8a.5.5 0 0 1 .5.5V12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V8.5a.5.5 0 0 1 1 0V12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8.5A.5.5 0 0 1 .5 8zM5 4.854a.5.5 0 0 0 .707 0L8 2.56l2.293 2.293A.5.5 0 1 0 11 4.146L8.354 1.5a.5.5 0 0 0-.708 0L5 4.146a.5.5 0 0 0 0 .708z" />
                     <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0v-8A.5.5 0 0 1 8 2z" />
                 </svg>
            </div>
            <div class="col-1">
                <svg width="2.2em" height="2.2em" viewBox="0 0 16 16" class="bi bi-cloud-arrow-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                     <path fill-rule="evenodd"
                         d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z" />
                     <path fill-rule="evenodd"
                         d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z" />
                 </svg>
            </div>


            <div class="col-1">
                <svg id="reset_download" width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-download" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="CURSOR: pointer">
                     <path fill-rule="evenodd"
                         d="M.5 8a.5.5 0 0 1 .5.5V12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V8.5a.5.5 0 0 1 1 0V12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8.5A.5.5 0 0 1 .5 8z" />
                     <path fill-rule="evenodd"
                         d="M5 7.5a.5.5 0 0 1 .707 0L8 9.793 10.293 7.5a.5.5 0 1 1 .707.707l-2.646 2.647a.5.5 0 0 1-.708 0L5 8.207A.5.5 0 0 1 5 7.5z" />
                     <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0v-8A.5.5 0 0 1 8 1z" />
                 </svg>

            </div>

        </div>
    </div>
    <br/>
    <br/>
    <br/>
    <!-- 底端信息栏 -->
    <div class="bottom-item">


        <div id=”footer”>
            Copyright © WUYIFAN.TOP <br /> last update 2020/7/4
        </div>

    </div>
</body>



<script>
    var im = new Image();
    var src = '{{PIC_SRC}}';
    im.src = src;
    var xxx={{RENEW}};
    var k = im.width / im.height;





    var range_brightness = document.getElementById('range_brightness');
    var btn_brightness = document.getElementById('btn_brightness');
    var brightness = 0;

    var range_vibrance = document.getElementById('range_vibrance');
    var btn_vibrance = document.getElementById('btn_vibrance');
    var vibrance = 0;

    var range_hue = document.getElementById('range_hue');
    var btn_hue = document.getElementById('btn_hue');
    var hue = 0;

    var range_contrast = document.getElementById('range_contrast');
    var btn_contrast = document.getElementById('btn_contrast');
    var contrast = 0;



    var flag_sinCity = false;
    var flag_Nostalgia = false;
    var flag_HazyDays = false;
    var flag_HerMajesty = false;
    var flag_Love = false;




    function changeV() {
        //if slider is moved use this function  
        brightness = parseFloat(range_brightness.value);
        document.getElementById('txt_brightness').value = brightness;

        vibrance = parseFloat(range_vibrance.value);
        document.getElementById('txt_vibrance').value = vibrance;

        hue = parseFloat(range_hue.value);
        document.getElementById('txt_hue').value = hue;

        contrast = parseFloat(range_contrast.value);
        document.getElementById('txt_contrast').value = contrast;




        Caman("#J_Canvas0", function() {
            // manipulate image here
            this.revert(false);
            this.brightness(brightness);
            this.vibrance(vibrance);
            this.hue(hue);
            this.contrast(contrast);
            if (flag_sinCity == true) this.sinCity();
            if (flag_Nostalgia == true) this.nostalgia();
            if (flag_HazyDays == true) this.hazyDays();
            if (flag_HerMajesty == true) this.herMajesty();
            if (flag_Love == true) this.love();



            this.render();
        });
    };


    /*
         btn_vibrance.onclick = function () {
             range_vibrance.value = 0;
             changeV();
         };

         btn_contrast.onclick = function () {
             range_contrast.value = 0;
             changeV();
         };

         btn_hue.onclick = function () {
             range_hue.value = 0;
             changeV();


             let name = prompt('请输入要保存的图片名称', '辉夜')
             var cc = document.getElementById('J_Canvas0');
             console.log(cc.toDataURL);
             if (name != null) {
                 let href = cc.toDataURL() // 获取canvas对应的base64编码
                 let a = document.createElement('a') // 创建a标签
                 a.download = name // 设置图片名字
                 a.href = href
                 a.dispatchEvent(new MouseEvent('click'))
             }


         };
    */

    $(document).ready(function() {

        $("#reset_brightness").click(function() {

            range_brightness.value = 0;
            changeV();
        });

        $("#reset_vibrance").click(function() {

            range_vibrance.value = 0;
            changeV();
        });
        $("#reset_hue").click(function() {

            range_hue.value = 0;
            changeV();
        });
        $("#reset_contrast").click(function() {

            range_contrast.value = 0;
            changeV();
        });



        $("#reset_download").click(function() {

            let name = prompt('请输入要保存的图片名称', '{{PIC_NAME}}')
            var cc = document.getElementById('J_Canvas0');
            console.log(cc.toDataURL);
            if (name != null) {
                let href = cc.toDataURL() // 获取canvas对应的base64编码
                let a = document.createElement('a') // 创建a标签
                a.download = name // 设置图片名字
                a.href = href
                a.dispatchEvent(new MouseEvent('click'))
            }
        });




        $("#sinCity").click(function() {
            var c = this.id;
            console.log(c);
            flag_sinCity = !flag_sinCity;
            changeV();
        });
        $("#Nostalgia").click(function() {

            flag_Nostalgia = !flag_Nostalgia;
            changeV();
        });
        $("#HazyDays").click(function() {

            flag_HazyDays = !flag_HazyDays;
            changeV();
        });
        $("#HerMajesty").click(function() {

            flag_HerMajesty = !flag_HerMajesty;
            changeV();
        });
        $("#Love").click(function() {

            flag_Love = !flag_Love;
            changeV();
        });



    });



    Caman("#J_Canvas0", src, function() {

        // manipulate image here
        this.resize({
            width: 400 * k,
            height: 400
        });
        this.brightness(brightness);
        this.render();
    });
</script>

</html>